<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Easeride Cab Booking – Georgia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      max-width: 700px;
      margin: auto;
    }
    label {
      margin-top: 12px;
      font-weight: bold;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      width: 100%;
      border: none;
      background: #008cff;
      color: white;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
    }
    #estimate {
      background: #eaf4ff;
      padding: 10px;
      margin-top: 15px;
      border-radius: 8px;
    }
    #map {
      height: 300px;
      margin-top: 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <form id="bookingForm">
    <h2>Cab Booking – Easeride Georgia</h2>
    <label>Full Name</label>
    <input type="text" id="name" required />
    <label>Mobile Number</label>
    <input type="tel" id="mobile" required />
    <label>Email</label>
    <input type="email" id="email" required />
    <label>Date and Time</label>
    <input type="datetime-local" id="datetime" required />
    <label>Pickup Address</label>
    <input type="text" id="pickup" required />
    <label>Drop-off Address</label>
    <input type="text" id="dropoff" required />
    <label>Service Type</label>
    <select id="serviceType">
      <option value="local">Local Ride (Tbilisi)</option>
      <option value="airport">Airport Transfer</option>
      <option value="intercity">Intercity Transfer</option>
      <option value="hourly">Hourly Hire</option>
    </select>
    <label>Vehicle Type</label>
    <select id="vehicleType">
      <option value="Toyota Prius">Toyota Prius – Sedan (1–3 pax)</option>
      <option value="Mercedes Vito">Mercedes Vito – Van (5–7 pax)</option>
      <option value="Toyota Highlander">Toyota Highlander – SUV (1–4 pax)</option>
      <option value="Mercedes E-Class">Mercedes E-Class – Executive Sedan</option>
    </select>
    <div id="estimate"></div>
    <div id="map"></div>
    <button type="button" onclick="calculateFare()">Estimate Fare</button>
    <button type="button" onclick="payNow()">Proceed to Payment</button>
  </form>

  <script>
    let fareAmount = 0;

    function calculateDistance(pickup, dropoff, callback) {
      fetch(`https://router.project-osrm.org/route/v1/driving/${pickup};${dropoff}?overview=false`)
        .then(res => res.json())
        .then(data => {
          const meters = data.routes[0].distance;
          const km = meters / 1000;
          callback(km);
        });
    }

    function calculateFare() {
      const service = document.getElementById('serviceType').value;
      const pickup = document.getElementById('pickup').value;
      const dropoff = document.getElementById('dropoff').value;
      const estimate = document.getElementById('estimate');
      estimate.innerHTML = 'Calculating fare...';

      if (service === 'local') {
        calculateDistance("44.7965,41.7151", "44.7820,41.7095", function(km) {
          let baseFare = 0;
          if (km <= 5) baseFare = 15;
          else if (km <= 10) baseFare = 20;
          else if (km <= 15) baseFare = 25;
          else if (km <= 20) baseFare = 30;
          else baseFare = (km * 1.5);

          fareAmount = parseFloat(baseFare.toFixed(2));
          const driverGets = (fareAmount * 0.85).toFixed(2);
          const youEarn = (fareAmount * 0.15).toFixed(2);
          estimate.innerHTML = `Estimated Fare: ${fareAmount} GEL<br>Driver Gets: ${driverGets} GEL<br>You Earn: ${youEarn} GEL`;
        });
      } else if (service === 'airport') {
        fareAmount = 45;
        estimate.innerHTML = `Fixed Fare (Airport): ${fareAmount} GEL<br>Driver: 38.25 GEL, You: 6.75 GEL`;
      } else if (service === 'intercity') {
        fareAmount = 200;
        estimate.innerHTML = `Fixed Fare (Intercity): ${fareAmount} GEL<br>Driver: 170 GEL, You: 30 GEL`;
      } else if (service === 'hourly') {
        fareAmount = 100;
        estimate.innerHTML = `Hourly Fare: ${fareAmount} GEL<br>Driver: 85 GEL, You: 15 GEL`;
      }
    }

    function payNow() {
      if (fareAmount <= 0) {
        alert('Please estimate the fare first.');
        return;
      }

      const options = {
        key: "YOUR_RAZORPAY_KEY",
        amount: fareAmount * 100,
        currency: "GEL",
        name: "Easeride",
        description: "Cab Booking Fare",
        handler: function (response) {
          alert("Payment successful! Payment ID: " + response.razorpay_payment_id);
        },
        prefill: {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          contact: document.getElementById("mobile").value
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }

    const map = L.map('map').setView([41.7151, 44.7831], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);
    L.marker([41.7151, 44.7831]).addTo(map).bindPopup('Tbilisi Center').openPopup();
  </script>
</body>
</html>
